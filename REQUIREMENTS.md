# Claude Code Chat 要件定義

## プロジェクト概要

スマートフォンからClaude Code CLIを操作可能にするチャットベースのWebインターフェース。

**主要目的:**
- モバイルデバイスでの開発作業効率向上
- 自然言語によるClaude Code操作
- リアルタイムストリーミング対応

## 実装済み機能

### 核心機能 ✅
- **チャットUI**: スマートフォン最適化、日本語対応
- **ストリーミング**: Server-Sent Events、リアルタイム進捗表示
- **セッション管理**: UUID生成、会話履歴保持
- **文脈理解**: 選択肢→回答の流れを理解した対話

### 高度機能 ✅  
- **Markdown対応**: .mdファイル時の美しい表示
- **コードハイライト**: Prism.js による多言語対応
- **フォールバック**: ストリーミング失敗時の自動切り替え
- **ESCキャンセル**: 処理中の即座なキャンセル

### ディレクトリナビゲーション ✅
- **セッション別作業ディレクトリ**: 独立した作業環境
- **コマンド操作**: `cd`, `ls`, `pwd` 対応
- **GUI操作**: ディレクトリバーによる視覚的操作

### マルチインスタンス ✅
- **複数同時起動**: 異なるポートでの並列実行
- **ポート競合検出**: 自動チェック機能
- **インスタンス識別**: プロセスIDによる識別

## 技術仕様

### アーキテクチャ
```
[スマートフォンブラウザ] ←→ [HTML Chat UI] ←→ [Python HTTPサーバー] ←→ [Claude Code CLI]
                                ↓                     ↓
                         [ストリーミング]        [セッション管理]
                         [進捗表示]              [ディレクトリ管理]
```

### 技術スタック
- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3  
- **バックエンド**: Python HTTP Server, python-dotenv
- **ストリーミング**: Server-Sent Events
- **マークアップ**: カスタム軽量パーサー + Prism.js
- **パッケージング**: pyproject.toml, pip installable

### API仕様
- **ストリーミング**: `POST /api/chat/stream` (SSE)
- **通常**: `POST /api/chat` (JSON)
- **ディレクトリ**: `POST /api/directory/change`, `/api/directory/info`
- **タイムアウト**: 180秒（3分）

## 使用例

### 基本的な使用シナリオ
```bash
# パッケージ起動
claude-code-chat

# スマートフォンでアクセス
http://127.0.0.1:8081/claude_chat.html

# チャットで指示
「test.py ファイルを作って」
→ 🔄 処理開始 → ⚙️ 初期化 → 💭 応答中 → ✅ 完了
→ 💰 $0.0127  ⏱️ 4.2秒
```

### 文脈理解の例
```
Claude: 「実行したいファイルを選んでください: 1. calculator.py 2. server.py」
User: 「1」
→ Claude が選択肢を理解して calculator.py を実行
```

### ディレクトリ操作
```bash
cd ./subdir            # サブディレクトリへ移動
ls                     # ディレクトリ内容一覧
pwd                    # 現在のパス表示
```

## 制約事項

- **ローカル専用**: 127.0.0.1、認証なし
- **権限**: `--dangerously-skip-permissions` 使用
- **セッション**: メモリ内保存（再起動で消失）
- **前提**: Claude Code CLI有効ライセンス必須